{"version":3,"file":"js/971.threejsBundle.js","mappings":"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","sources":["webpack://webxr-threejs/./src/support/customLoadingBar.ts","webpack://webxr-threejs/./src/support/assetLoader.ts","webpack://webxr-threejs/./src/support/xrSupport.ts","webpack://webxr-threejs/./src/support/torchController.ts","webpack://webxr-threejs/./src/support/shaders/volumetricSpotlightMaterial.ts","webpack://webxr-threejs/./src/scenes/main.ts"],"sourcesContent":["const canvas = document.getElementById(\"renderCanvas\") as HTMLCanvasElement;\nlet loadingDiv = document.getElementById(\"loadingDiv\");\nlet progress = \"0%\";\nlet loadingText = \"\";\n\n// Resize\nconst resizeLoadingUI = () => {\n  const canvasRect = canvas.getBoundingClientRect();\n  const canvasPositioning = window.getComputedStyle(canvas).position;\n\n  const loadingDiv = document.getElementById(\"loadingDiv\");\n  if (!loadingDiv) {\n    return;\n  }\n\n  loadingDiv.style.position =\n    canvasPositioning === \"fixed\" ? \"fixed\" : \"absolute\";\n  loadingDiv.style.left = canvasRect.left + \"px\";\n  loadingDiv.style.top = canvasRect.top + \"px\";\n  loadingDiv.style.width = canvasRect.width + \"px\";\n  loadingDiv.style.height = canvasRect.height + \"px\";\n};\n\nexport const showCustomLoadingBar = () => {\n  if (loadingDiv) {\n    return loadingDiv;\n  }\n  loadingDiv = document.createElement(\"div\");\n  loadingDiv.id = \"loadingDiv\";\n\n  loadingDiv.style.height = \"100vh\";\n  loadingDiv.style.width = \"100%\";\n  loadingDiv.style.pointerEvents = \"none\";\n  loadingDiv.style.opacity = \"1\";\n  loadingDiv.style.backgroundColor = \"black\";\n  loadingDiv.style.zIndex = \"-1\";\n  loadingDiv.style.transition = \"opacity 1.5s ease\";\n\n  // loading container\n  const loadingContainer = document.createElement(\"div\");\n  loadingContainer.style.display = \"flex\";\n  loadingContainer.style.alignItems = \"center\";\n  loadingContainer.style.justifyItems = \"center\";\n  loadingContainer.style.justifyContent = \"center\";\n  loadingContainer.style.minHeight = \"100%\";\n  loadingContainer.style.textAlign = \"center\";\n  // div holder\n  const div = document.createElement(\"div\");\n  // container\n  const container = document.createElement(\"div\");\n  container.style.color = \"rgba(66, 135, 245, 1)\";\n  container.style.textAlign = \"center\";\n\n  // holder\n  // const holder = document.createElement(\"div\");\n  // holder.id = \"holder\";\n  // holder.style.lineHeight = \"1.5\";\n  // holder.style.borderRadius = \"9999px\";\n  // holder.style.background = \"white\";\n  // holder.style.height = \"200px\";\n  // holder.style.width = \"200px\";\n  // holder.style.display = \"flex\";\n  // holder.style.alignItems = \"center\";\n  // holder.style.justifyContent = \"center\";\n  // holder.appendChild(logo);\n  // container.appendChild(holder);\n\n  // Heading\n  const heading = document.createElement(\"h3\");\n  heading.innerHTML = \"Please hang tight..\";\n  heading.style.fontSize = \"1.125rem\";\n  heading.style.lineHeight = \"1.5rem\";\n  heading.style.fontWeight = \"500\";\n\n  container.appendChild(heading);\n\n  // Loading text\n  const loadingTextP = document.createElement(\"p\");\n  loadingTextP.id = \"loadingText\";\n  loadingTextP.innerHTML = \"\";\n\n  // Update section\n  const updateDiv = document.createElement(\"div\");\n  updateDiv.style.width = \"100%\";\n  updateDiv.style.backgroundColor = \"gray\";\n  updateDiv.style.borderRadius = \"9999px\";\n  updateDiv.style.height = \"0.625rem\";\n\n  // Percent section\n  const progresssDiv = document.createElement(\"div\");\n  progresssDiv.style.width = progress;\n  progresssDiv.style.backgroundColor = \"blue\";\n  progresssDiv.style.height = \"0.625rem\";\n  progresssDiv.style.borderRadius = \"9999px\";\n  progresssDiv.id = \"progressLevel\";\n\n  updateDiv.appendChild(progresssDiv);\n\n  container.appendChild(updateDiv);\n\n  div.appendChild(container);\n  loadingContainer.appendChild(div);\n\n  container.appendChild(loadingTextP);\n  loadingDiv.appendChild(loadingContainer);\n\n  resizeLoadingUI();\n\n  document.body.insertBefore(loadingDiv, canvas);\n  return loadingDiv;\n};\n\nexport const hideCustomLoadingBar = () => {\n  const loadingDiv = document.getElementById(\"loadingDiv\");\n  if (!loadingDiv) {\n    return;\n  }\n\n  const onTransitionEnd = () => {\n    if (loadingDiv) {\n      loadingDiv.remove();\n    }\n  };\n\n  loadingDiv.style.opacity = \"0\";\n  loadingDiv.addEventListener(\"transitionend\", onTransitionEnd);\n};\n\nexport const updateProgress = (progressUpdate: string) => {\n  const progressLevel = document.getElementById(\"progressLevel\");\n  progress = progressUpdate;\n  if (progressLevel) {\n    progressLevel.style.width = progress;\n  }\n};\n\nexport const setLoadingText = (updateText: string) => {\n  const loadingTextElem = document.getElementById(\"loadingText\");\n  loadingText = updateText;\n  if (loadingTextElem) {\n    loadingTextElem.innerHTML = loadingText;\n  }\n};\n","import { LoadingManager } from \"three\";\nimport { GLTF, GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport { setLoadingText, updateProgress } from \"./customLoadingBar\";\n\ntype ModelAssets = {\n  [key: string]: GLTF;\n};\n\nexport interface AssetContainer {\n  models: ModelAssets;\n}\n\nconst assets: AssetContainer = {\n  models: {},\n};\n\n// Models to load\nlet models = [\"snowScene.glb\", \"torch.glb\"];\n\n// Loading manager to track progress\nconst loadingManager = new LoadingManager();\n\n// Load glTF resource\nexport const loadModel = async (\n  loader: GLTFLoader,\n  model: string\n): Promise<GLTF> =>\n  new Promise((resolve) => {\n    loader.load(\n      // resource URL\n      `models/${model}`,\n      // called when the resource is loaded - onLoad\n      (gltf) => {\n        resolve(gltf);\n      }\n      // Issues with loading GLTF files so using LoadingManager to track loading progress\n      // called while loading is progressing (http request object {loaded and total keys}) - onProgress\n      // (xhr) => {\n      //   console.log((xhr.loaded / xhr.total) * 100 + \"% loaded\");\n      // },\n      // called when loading has errors - onError\n      // (error) => {\n      //   console.log(\"An error happened: \", error.message);\n      //   reject(error);\n      // }\n    );\n  });\n\n// Allow loading of all resources\nexport const loadAssets = () =>\n  new Promise<AssetContainer>(async (resolve, reject) => {\n    loadingManager.onProgress = (url, itemsLoaded, itemsTotal) => {\n      const percent = Number((itemsLoaded / itemsTotal) * 100).toFixed(0);\n      updateProgress(`${percent}%`);\n      setLoadingText(`Loaded ${itemsLoaded} of ${itemsTotal} files.`);\n    };\n\n    loadingManager.onError = (url) => {\n      reject(\"There was an error loading \" + url);\n    };\n\n    const loader = new GLTFLoader(loadingManager).setPath(\"assets/\");\n    for (const model of models) {\n      try {\n        const gltf = await loadModel(loader, model);\n        assets.models[model] = gltf;\n      } catch (err) {\n        console.log(\"Error loading model: \", err);\n        reject(err);\n      }\n    }\n    resolve(assets);\n  });\n","import { Vector3, BufferGeometry, Line, WebGLRenderer, Scene } from \"three\";\nimport { XRControllerModelFactory } from \"three/examples/jsm/webxr/XRControllerModelFactory\";\n\nexport const createControllers = (renderer: WebGLRenderer, scene: Scene) => {\n  const controllerModelFactory = new XRControllerModelFactory();\n\n  const geometry = new BufferGeometry().setFromPoints([\n    new Vector3(0, 0, 0),\n    new Vector3(0, 0, -1),\n  ]);\n\n  const line = new Line(geometry);\n  line.name = \"line\";\n  line.scale.z = 0;\n\n  const controllers = [];\n\n  for (let i = 0; i <= 1; i++) {\n    const controller = renderer.xr.getController(i);\n    controller.add(line.clone());\n    controller.userData.selectPressed = false;\n    const grip = renderer.xr.getControllerGrip(i);\n    grip.add(controllerModelFactory.createControllerModel(grip));\n    scene.add(controller);\n    scene.add(grip);\n    controllers.push({ controller, grip });\n  }\n\n  return controllers;\n};\n\nexport const createButton = async (renderer: WebGLRenderer) => {\n  let xrSessionIsGranted = false;\n\n  const registerSessionGrantedListener = () => {\n    if (navigator.xr) {\n      // WebXRViewer (based on Firefox) has a bug where addEventListener\n      // throws a silent exception and aborts execution entirely.\n      if (/WebXRViewer\\//i.test(navigator.userAgent)) return;\n\n      navigator.xr.addEventListener(\"sessiongranted\", () => {\n        xrSessionIsGranted = true;\n      });\n    }\n  };\n\n  registerSessionGrantedListener();\n  let currentSession: any = null;\n  const button = document.createElement(\"button\");\n  button.style.display = \"\";\n  button.style.cursor = \"pointer\";\n  button.style.left = \"calc(50% - 50px)\";\n  button.style.width = \"100px\";\n  button.textContent = \"ENTER VR\";\n\n  const showEnterVR = () => {\n    const onSessionStarted = async (session: any) => {\n      session.addEventListener(\"end\", onSessionEnded);\n      await renderer.xr.setSession(session);\n      button.textContent = \"EXIT VR\";\n\n      currentSession = session;\n    };\n\n    const onSessionEnded = () => {\n      currentSession.removeEventListener(\"end\", onSessionEnded);\n      button.textContent = \"ENTER VR\";\n      currentSession = null;\n    };\n\n    button.onmouseleave = () => {\n      button.style.opacity = \"0.5\";\n    };\n\n    button.onmouseenter = () => {\n      button.style.opacity = \"1.0\";\n    };\n\n    button.onclick = async () => {\n      if (currentSession === null && navigator.xr) {\n        // WebXR's requestReferenceSpace only works if the corresponding feature\n        // was requested at session creation time. For simplicity, just ask for\n        // the interesting ones as optional features, but be aware that the\n        // requestReferenceSpace call will fail if it turns out to be unavailable.\n        // ('local' is always available for immersive sessions and doesn't need to\n        // be requested separately.)\n        const sessionInit = {\n          optionalFeatures: [\n            \"local-floor\",\n            \"bounded-floor\",\n            \"hand-tracking\",\n            \"layers\",\n          ],\n        };\n        try {\n          const session = await navigator.xr.requestSession(\n            \"immersive-vr\",\n            sessionInit\n          );\n          onSessionStarted(session);\n        } catch (err) {\n          console.log(err);\n        }\n      } else {\n        currentSession.end();\n      }\n    };\n  };\n\n  const disableButton = () => {\n    button.style.display = \"\";\n\n    button.style.cursor = \"auto\";\n    button.style.left = \"0\";\n    button.style.width = \"100%\";\n    button.style.background = \"red\";\n\n    button.onmouseenter = null;\n    button.onmouseleave = null;\n\n    button.onclick = null;\n  };\n\n  const showWebXRNotFound = () => {\n    disableButton();\n    button.textContent = \"VR NOT SUPPORTED\";\n  };\n\n  const showVRNotAllowed = (exception: any) => {\n    disableButton();\n    console.warn(\n      \"Exception when trying to call xr.isSessionSupported\",\n      exception\n    );\n    button.textContent = \"VR NOT ALLOWED\";\n  };\n\n  const stylizeElement = (element: HTMLButtonElement | HTMLAnchorElement) => {\n    element.style.position = \"absolute\";\n    element.style.bottom = \"20px\";\n    element.style.padding = \"12px 6px\";\n    element.style.border = \"1px solid #fff\";\n    element.style.borderRadius = \"4px\";\n    element.style.background = \"rgba(0,0,0,0.1)\";\n    element.style.color = \"#fff\";\n    element.style.font = \"normal 13px sans-serif\";\n    element.style.textAlign = \"center\";\n    element.style.opacity = \"0.5\";\n    element.style.outline = \"none\";\n  };\n\n  if (navigator.xr) {\n    button.id = \"VRButton\";\n\n    stylizeElement(button);\n\n    try {\n      const supported = await navigator.xr.isSessionSupported(\"immersive-vr\");\n      supported ? showEnterVR() : showWebXRNotFound();\n      if (supported && xrSessionIsGranted) {\n        button.click();\n      }\n    } catch (err) {\n      showVRNotAllowed(err);\n    }\n\n    return button;\n  } else {\n    const message = document.createElement(\"a\");\n\n    if (window.isSecureContext === false) {\n      message.href = document.location.href.replace(/^http:/, \"https:\");\n      message.innerHTML = \"WEBXR NEEDS HTTPS\";\n    } else {\n      message.href = \"https://immersiveweb.dev/\";\n      message.innerHTML = \"WEBXR NOT AVAILABLE\";\n    }\n\n    message.style.left = \"calc(50% - 90px)\";\n    message.style.width = \"180px\";\n    message.style.textDecoration = \"none\";\n\n    stylizeElement(message);\n\n    return message;\n  }\n};\n","import {\n  XRTargetRaySpace,\n  XRGripSpace,\n  Group,\n  SpotLight,\n  CylinderGeometry,\n  Mesh,\n  Event,\n} from \"three\";\nimport { AssetContainer } from \"./assetLoader\";\nimport { volumetricSpotLightMaterial } from \"./shaders/volumetricSpotlightMaterial\";\n\nexport const createSpotLight = (\n  event: Event & {\n    type: \"connected\";\n  } & {\n    target: XRTargetRaySpace;\n  },\n  controllerGroup: {\n    controller: XRTargetRaySpace;\n    grip: XRGripSpace;\n  },\n  assets: AssetContainer\n) => {\n  if (event.data.targetRayMode === \"tracked-pointer\") {\n    const torchAsset = assets.models[\"torch.glb\"];\n    const torch = torchAsset.scene;\n    torch.scale.set(0.2, 0.2, 0.2);\n    controllerGroup.controller.remove(...controllerGroup.controller.children);\n    controllerGroup.grip.remove(...controllerGroup.grip.children);\n\n    // add spotlight\n    const spotlightGroup = new Group();\n    spotlightGroup.name = \"spotlight\";\n    const spotlight = new SpotLight(0xffffff, 2, 12, Math.PI / 15, 0.3);\n    spotlight.position.set(0, 0, 0);\n    spotlight.target.position.set(0, 0, -1);\n    spotlightGroup.add(spotlight.target);\n    spotlightGroup.add(spotlight);\n\n    const geometry = new CylinderGeometry(0.03, 1, 5, 32, 5, true);\n    geometry.rotateX(Math.PI / 2);\n    const material = volumetricSpotLightMaterial();\n    const mesh = new Mesh(geometry, material);\n    mesh.translateZ(-2.6);\n    spotlightGroup.add(mesh);\n\n    spotlightGroup.visible = false;\n\n    controllerGroup.controller.add(torch);\n    controllerGroup.controller.add(spotlightGroup);\n  }\n};\n","import { Color, ShaderMaterial, Vector3 } from \"three\";\n\n// Based on https://github.com/jeromeetienne/threex.volumetricspotlight\nexport const volumetricSpotLightMaterial = (\n  color = new Color(0xffffff),\n  position = new Vector3(),\n  attenuation = 5.0,\n  anglePower = 1.2\n) => {\n  const vertexShader = [\n    \"varying vec3 vNormal;\",\n    \"varying vec3 vWorldPosition;\",\n\n    \"void main(){\",\n    \"// compute intensity\",\n    \"vNormal\t\t= normalize( normalMatrix * normal );\",\n\n    \"vec4 worldPosition\t= modelMatrix * vec4( position, 1.0 );\",\n    \"vWorldPosition\t\t= worldPosition.xyz;\",\n\n    \"// set gl_Position\",\n    \"gl_Position\t= projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\n    \"}\",\n  ].join(\"\\n\");\n\n  const fragmentShader = [\n    \"varying vec3\t\tvNormal;\",\n    \"varying vec3\t\tvWorldPosition;\",\n\n    \"uniform vec3\t\tlightColor;\",\n\n    \"uniform vec3\t\tspotPosition;\",\n\n    \"uniform float\t\tattenuation;\",\n    \"uniform float\t\tanglePower;\",\n\n    \"void main(){\",\n    \"float intensity;\",\n\n    //////////////////////////////////////////////////////////\n    // distance attenuation\t\t\t\t\t//\n    //////////////////////////////////////////////////////////\n    \"intensity\t= distance(vWorldPosition, spotPosition)/attenuation;\",\n    \"intensity\t= 1.0 - clamp(intensity, 0.0, 1.0);\",\n\n    //////////////////////////////////////////////////////////\n    // intensity on angle\t\t\t\t\t//\n    //////////////////////////////////////////////////////////\n    \"vec3 normal\t= vec3(vNormal.x, vNormal.y, abs(vNormal.z));\",\n    \"float angleIntensity\t= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );\",\n    \"intensity\t= intensity * angleIntensity;\",\n    // 'gl_FragColor\t= vec4( lightColor, intensity );',\n\n    //////////////////////////////////////////////////////////\n    // final color\t\t\t\t\t\t//\n    //////////////////////////////////////////////////////////\n\n    // set the final color\n    \"gl_FragColor\t= vec4( lightColor, intensity);\",\n    \"}\",\n  ].join(\"\\n\");\n\n  // create custom material from the shader code above\n  //   that is within specially labeled script tags\n  const material = new ShaderMaterial({\n    uniforms: {\n      attenuation: {\n        value: attenuation,\n      },\n      anglePower: {\n        value: anglePower,\n      },\n      spotPosition: {\n        value: position,\n      },\n      lightColor: {\n        value: color,\n      },\n    },\n    vertexShader: vertexShader,\n    fragmentShader: fragmentShader,\n    // side\t\t: THREE.DoubleSide,\n    // blending\t: THREE.AdditiveBlending,\n    transparent: true,\n    depthWrite: false,\n  });\n  return material;\n};\n","import {\n  BackSide,\n  DirectionalLight,\n  HemisphereLight,\n  Matrix4,\n  Mesh,\n  MeshBasicMaterial,\n  PerspectiveCamera,\n  PlaneGeometry,\n  PMREMGenerator,\n  Raycaster,\n  Scene,\n  SphereGeometry,\n  WebGLRenderer,\n} from \"three\";\nimport { RGBELoader } from \"three/examples/jsm/loaders/RGBELoader\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\nimport { CreateSceneClass } from \"../createScene\";\nimport { loadAssets } from \"../support/assetLoader\";\nimport {\n  hideCustomLoadingBar,\n  showCustomLoadingBar,\n} from \"../support/customLoadingBar\";\nimport { createButton, createControllers } from \"../support/xrSupport\";\nimport { createSpotLight } from \"../support/torchController\";\n\nexport class MainScreen implements CreateSceneClass {\n  createScene = async (\n    renderer: WebGLRenderer\n  ): Promise<{\n    scene: Scene;\n    camera: PerspectiveCamera;\n    update: () => void;\n  }> => {\n    const generator = new PMREMGenerator(renderer);\n    const workingMatrix = new Matrix4();\n    const raycaster = new Raycaster();\n\n    // Create skybox\n    new RGBELoader().load(\"assets/textures/snowy_park.hdr\", (hdrmap) => {\n      const envmap = generator.fromEquirectangular(hdrmap);\n      scene.background = envmap.texture;\n      scene.environment = envmap.texture;\n    });\n\n    const scene = new Scene();\n    const camera = new PerspectiveCamera(\n      60,\n      window.innerWidth / window.innerHeight,\n      0.1,\n      100\n    );\n    camera.position.set(0, 1.6, 3);\n\n    // Add light\n    scene.add(new HemisphereLight(0x606060, 0x404040));\n    const light = new DirectionalLight(0xffffff);\n    light.position.set(1, 1, 1).normalize();\n    scene.add(light);\n\n    // Enable XR\n    renderer.xr.enabled = true;\n\n    // Add controls\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.minDistance = 2;\n    controls.maxDistance = 10;\n    controls.target.set(0, 2, 0);\n    controls.update();\n\n    const loadingElem = showCustomLoadingBar();\n\n    const assets = await loadAssets();\n    const snowSceneAsset = assets.models[\"snowScene.glb\"];\n\n    scene.add(snowSceneAsset.scene);\n    let snowMat;\n    const loadedMaterials = await snowSceneAsset.parser.getDependencies(\n      \"material\"\n    );\n    for (const material of loadedMaterials) {\n      if (material.name === \"Snow\") {\n        snowMat = material;\n      }\n    }\n\n    // Create ground\n    if (snowMat) {\n      const geometry = new PlaneGeometry(100, 100, 20, 20);\n      const ground = new Mesh(geometry, snowMat);\n      ground.rotation.x = -Math.PI / 2;\n      scene.add(ground);\n    }\n\n    // Add a sphere\n    const geometry = new SphereGeometry(0.2, 20);\n    const material = new MeshBasicMaterial({ color: 0x00ff00 });\n    const sphere = new Mesh(geometry, material);\n    sphere.position.set(5, 1, -8);\n    scene.add(sphere);\n\n    const sphereHighlight = new Mesh(\n      geometry,\n      new MeshBasicMaterial({ color: 0xffffff, side: BackSide })\n    );\n    sphereHighlight.scale.set(1.2, 1.2, 1.2);\n\n    // Create Controllerss\n    const controllers = createControllers(renderer, scene);\n\n    for (const controllerGroup of controllers) {\n      controllerGroup.controller.addEventListener(\"selectstart\", () => {\n        for (const child of controllerGroup.controller.children) {\n          if (child.name === \"line\") {\n            child.scale.z = 10;\n          }\n          if (child.name === \"spotlight\" && !child.visible) {\n            child.visible = true;\n          }\n        }\n        controllerGroup.controller.userData.selectPressed = true;\n      });\n\n      controllerGroup.controller.addEventListener(\"selectend\", () => {\n        for (const child of controllerGroup.controller.children) {\n          if (child.name === \"line\") {\n            child.scale.z = 0;\n            sphereHighlight.visible = false;\n          }\n          if (child.name === \"spotlight\" && child.visible) {\n            child.visible = false;\n          }\n        }\n        controllerGroup.controller.userData.selectPressed = false;\n      });\n\n      controllerGroup.controller.addEventListener(\"disconnected\", () => {\n        controllerGroup.controller.remove(\n          ...controllerGroup.controller.children\n        );\n      });\n\n      controllerGroup.controller.addEventListener(\"connected\", (event) => {\n        const handedness = event.data.handedness;\n        controllerGroup.controller.name = `${handedness}Controller`;\n        if (handedness === \"left\") {\n          createSpotLight(event, controllerGroup, assets);\n        }\n      });\n    }\n\n    const handleController = () => {\n      const controllerGroup =\n        controllers[0].controller.name === \"leftController\"\n          ? controllers[0]\n          : controllers[1];\n      if (\n        controllerGroup.controller &&\n        controllerGroup.controller.userData.selectPressed\n      ) {\n        workingMatrix\n          .identity()\n          .extractRotation(controllerGroup.controller.matrixWorld);\n\n        raycaster.ray.origin.setFromMatrixPosition(\n          controllerGroup.controller.matrixWorld\n        );\n        raycaster.ray.direction.set(0, 0, -1).applyMatrix4(workingMatrix);\n\n        const intersects = raycaster.intersectObjects([sphere]);\n\n        if (intersects.length > 0) {\n          intersects[0].object.add(sphereHighlight);\n          sphereHighlight.visible = true;\n        } else {\n          sphereHighlight.visible = false;\n        }\n      }\n    };\n\n    // Create custom VR Button\n    const vrButton = await createButton(renderer);\n    // Append the VR button to the dom\n    document.body.insertBefore(vrButton, loadingElem);\n\n    // Update next tick before render\n    const update = () => {\n      handleController();\n    };\n\n    // Hide the loading screen\n    hideCustomLoadingBar();\n\n    return { scene, camera, update };\n  };\n}\n\nexport default new MainScreen();\n"],"names":["canvas","document","getElementById","loadingDiv","progress","loadingText","assets","models","loadingManager","loadModel","loader","model","Promise","resolve","load","gltf","loadAssets","reject","onProgress","url","itemsLoaded","itemsTotal","progressUpdate","progressLevel","style","width","updateProgress","Number","toFixed","updateText","loadingTextElem","innerHTML","setLoadingText","onError","GLTFLoader","setPath","err","console","log","createButton","renderer","xrSessionIsGranted","navigator","xr","test","userAgent","addEventListener","registerSessionGrantedListener","currentSession","button","createElement","display","cursor","left","textContent","disableButton","background","onmouseenter","onmouseleave","onclick","stylizeElement","element","position","bottom","padding","border","borderRadius","color","font","textAlign","opacity","outline","id","supported","isSessionSupported","onSessionEnded","removeEventListener","sessionInit","optionalFeatures","session","requestSession","setSession","end","showEnterVR","click","exception","warn","message","window","isSecureContext","href","location","replace","textDecoration","createSpotLight","event","controllerGroup","data","targetRayMode","torch","scene","scale","set","controller","remove","children","grip","spotlightGroup","name","spotlight","Math","PI","target","add","geometry","rotateX","material","attenuation","anglePower","vertexShader","join","fragmentShader","uniforms","value","spotPosition","lightColor","transparent","depthWrite","volumetricSpotLightMaterial","mesh","translateZ","visible","MainScreen","createScene","generator","workingMatrix","raycaster","RGBELoader","hdrmap","envmap","fromEquirectangular","texture","environment","camera","innerWidth","innerHeight","light","normalize","enabled","controls","OrbitControls","domElement","minDistance","maxDistance","update","loadingElem","height","pointerEvents","backgroundColor","zIndex","transition","loadingContainer","alignItems","justifyItems","justifyContent","minHeight","div","container","heading","fontSize","lineHeight","fontWeight","appendChild","loadingTextP","updateDiv","progresssDiv","canvasRect","getBoundingClientRect","canvasPositioning","getComputedStyle","top","resizeLoadingUI","body","insertBefore","showCustomLoadingBar","snowSceneAsset","snowMat","loadedMaterials","parser","getDependencies","ground","rotation","x","sphere","sphereHighlight","side","controllers","controllerModelFactory","XRControllerModelFactory","setFromPoints","line","z","i","getController","clone","userData","selectPressed","getControllerGrip","createControllerModel","push","createControllers","child","handedness","vrButton","hideCustomLoadingBar","identity","extractRotation","matrixWorld","ray","origin","setFromMatrixPosition","direction","applyMatrix4","intersects","intersectObjects","length","object","handleController"],"sourceRoot":""}