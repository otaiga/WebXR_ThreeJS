"use strict";(self.webpackChunkwebxr_threejs=self.webpackChunkwebxr_threejs||[]).push([[971],{971:(e,t,n)=>{n.r(t),n.d(t,{MainScreen:()=>b,default:()=>E});var o=n(75),r=n(579),i=n(12),l=n(418);const s=document.getElementById("renderCanvas");let a=document.getElementById("loadingDiv"),c="0%",d="";var u=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((o=o.apply(e,t||[])).next())}))};const y={models:{}};let v=["snowScene.glb","torch.glb"];const m=new o.lLk,p=(e,t)=>u(void 0,void 0,void 0,(function*(){return new Promise((n=>{e.load(`models/${t}`,(e=>{n(e)}))}))})),g=()=>new Promise(((e,t)=>u(void 0,void 0,void 0,(function*(){m.onProgress=(e,t,n)=>{(e=>{const t=document.getElementById("progressLevel");c=e,t&&(t.style.width=c)})(`${Number(t/n*100).toFixed(0)}%`),(e=>{const t=document.getElementById("loadingText");d=e,t&&(t.innerHTML=d)})(`Loaded ${t} of ${n} files.`)},m.onError=e=>{t("There was an error loading "+e)};const n=new l.E(m).setPath("assets/");for(const e of v)try{const t=yield p(n,e);y.models[e]=t}catch(e){console.log("Error loading model: ",e),t(e)}e(y)}))));var f=n(922),h=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((o=o.apply(e,t||[])).next())}))};const w=e=>h(void 0,void 0,void 0,(function*(){let t=!1;(()=>{if(navigator.xr){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(()=>{t=!0}))}})();let n=null;const o=document.createElement("button");o.style.display="",o.style.cursor="pointer",o.style.left="calc(50% - 50px)",o.style.width="100px",o.textContent="ENTER VR";const r=()=>{o.style.display="",o.style.cursor="auto",o.style.left="0",o.style.width="100%",o.style.background="red",o.onmouseenter=null,o.onmouseleave=null,o.onclick=null},i=e=>{e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none"};if(navigator.xr){o.id="VRButton",i(o);try{const i=yield navigator.xr.isSessionSupported("immersive-vr");i?(()=>{const t=()=>{n.removeEventListener("end",t),o.textContent="ENTER VR",n=null};o.onmouseleave=()=>{o.style.opacity="0.5"},o.onmouseenter=()=>{o.style.opacity="1.0"},o.onclick=()=>h(void 0,void 0,void 0,(function*(){if(null===n&&navigator.xr){const i={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};try{r=yield navigator.xr.requestSession("immersive-vr",i),h(void 0,void 0,void 0,(function*(){r.addEventListener("end",t),yield e.xr.setSession(r),o.textContent="EXIT VR",n=r}))}catch(e){console.log(e)}}else n.end();var r}))})():(r(),o.textContent="VR NOT SUPPORTED"),i&&t&&o.click()}catch(e){l=e,r(),console.warn("Exception when trying to call xr.isSessionSupported",l),o.textContent="VR NOT ALLOWED"}return o}{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",i(e),e}var l})),x=(e,t,n)=>{if("tracked-pointer"===e.data.targetRayMode){const e=n.models["torch.glb"].scene;e.scale.set(.2,.2,.2),t.controller.remove(...t.controller.children),t.grip.remove(...t.grip.children);const r=new o.ZAu;r.name="spotlight";const i=new o.PMe(16777215,2,12,Math.PI/15,.3);i.position.set(0,0,0),i.target.position.set(0,0,-1),r.add(i.target),r.add(i);const l=new o.fHI(.03,1,5,32,5,!0);l.rotateX(Math.PI/2);const s=((e=new o.Ilk(16777215),t=new o.Pa4,n=5,r=1.2)=>{const i=["varying vec3 vNormal;","varying vec3 vWorldPosition;","void main(){","// compute intensity","vNormal\t\t= normalize( normalMatrix * normal );","vec4 worldPosition\t= modelMatrix * vec4( position, 1.0 );","vWorldPosition\t\t= worldPosition.xyz;","// set gl_Position","gl_Position\t= projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),l=["varying vec3\t\tvNormal;","varying vec3\t\tvWorldPosition;","uniform vec3\t\tlightColor;","uniform vec3\t\tspotPosition;","uniform float\t\tattenuation;","uniform float\t\tanglePower;","void main(){","float intensity;","intensity\t= distance(vWorldPosition, spotPosition)/attenuation;","intensity\t= 1.0 - clamp(intensity, 0.0, 1.0);","vec3 normal\t= vec3(vNormal.x, vNormal.y, abs(vNormal.z));","float angleIntensity\t= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );","intensity\t= intensity * angleIntensity;","gl_FragColor\t= vec4( lightColor, intensity);","}"].join("\n");return new o.jyz({uniforms:{attenuation:{value:n},anglePower:{value:r},spotPosition:{value:t},lightColor:{value:e}},vertexShader:i,fragmentShader:l,transparent:!0,depthWrite:!1})})(),a=new o.Kj0(l,s);a.translateZ(-2.6),r.add(a),r.visible=!1,t.controller.add(e),t.controller.add(r)}};class b{constructor(){this.createScene=e=>{return t=this,n=void 0,d=function*(){const t=new o.anP(e),n=new o.yGw,l=new o.iMs;(new r.x).load("assets/textures/snowy_park.hdr",(e=>{const n=t.fromEquirectangular(e);d.background=n.texture,d.environment=n.texture}));const d=new o.xsS,u=new o.cPb(60,window.innerWidth/window.innerHeight,.1,100);u.position.set(0,1.6,3),d.add(new o.vmT(6316128,4210752));const y=new o.Ox3(16777215);y.position.set(1,1,1).normalize(),d.add(y),e.xr.enabled=!0;const v=new i.z(u,e.domElement);v.minDistance=2,v.maxDistance=10,v.target.set(0,2,0),v.update();const m=(()=>{if(a)return a;a=document.createElement("div"),a.id="loadingDiv",a.style.height="100vh",a.style.width="100%",a.style.pointerEvents="none",a.style.opacity="1",a.style.backgroundColor="black",a.style.zIndex="-1",a.style.transition="opacity 1.5s ease";const e=document.createElement("div");e.style.display="flex",e.style.alignItems="center",e.style.justifyItems="center",e.style.justifyContent="center",e.style.minHeight="100%",e.style.textAlign="center";const t=document.createElement("div"),n=document.createElement("div");n.style.color="rgba(66, 135, 245, 1)",n.style.textAlign="center";const o=document.createElement("h3");o.innerHTML="Please hang tight..",o.style.fontSize="1.125rem",o.style.lineHeight="1.5rem",o.style.fontWeight="500",n.appendChild(o);const r=document.createElement("p");r.id="loadingText",r.innerHTML="";const i=document.createElement("div");i.style.width="100%",i.style.backgroundColor="gray",i.style.borderRadius="9999px",i.style.height="0.625rem";const l=document.createElement("div");return l.style.width=c,l.style.backgroundColor="blue",l.style.height="0.625rem",l.style.borderRadius="9999px",l.id="progressLevel",i.appendChild(l),n.appendChild(i),t.appendChild(n),e.appendChild(t),n.appendChild(r),a.appendChild(e),(()=>{const e=s.getBoundingClientRect(),t=window.getComputedStyle(s).position,n=document.getElementById("loadingDiv");n&&(n.style.position="fixed"===t?"fixed":"absolute",n.style.left=e.left+"px",n.style.top=e.top+"px",n.style.width=e.width+"px",n.style.height=e.height+"px")})(),document.body.insertBefore(a,s),a})(),p=yield g(),h=p.models["snowScene.glb"];let b;d.add(h.scene);const E=yield h.parser.getDependencies("material");for(const e of E)"Snow"===e.name&&(b=e);if(b){const e=new o._12(100,100,20,20),t=new o.Kj0(e,b);t.rotation.x=-Math.PI/2,d.add(t)}const P=new o.xo$(.2,20),C=new o.vBJ({color:65280}),L=new o.Kj0(P,C);L.position.set(5,1,-8),d.add(L);const S=new o.Kj0(P,new o.vBJ({color:16777215,side:o._Li}));S.scale.set(1.2,1.2,1.2);const k=((e,t)=>{const n=new f.i,r=(new o.u9r).setFromPoints([new o.Pa4(0,0,0),new o.Pa4(0,0,-1)]),i=new o.x12(r);i.name="line",i.scale.z=0;const l=[];for(let o=0;o<=1;o++){const r=e.xr.getController(o);r.add(i.clone()),r.userData.selectPressed=!1;const s=e.xr.getControllerGrip(o);s.add(n.createControllerModel(s)),t.add(r),t.add(s),l.push({controller:r,grip:s})}return l})(e,d);for(const e of k)e.controller.addEventListener("selectstart",(()=>{for(const t of e.controller.children)"line"===t.name&&(t.scale.z=10),"spotlight"!==t.name||t.visible||(t.visible=!0);e.controller.userData.selectPressed=!0})),e.controller.addEventListener("selectend",(()=>{for(const t of e.controller.children)"line"===t.name&&(t.scale.z=0,S.visible=!1),"spotlight"===t.name&&t.visible&&(t.visible=!1);e.controller.userData.selectPressed=!1})),e.controller.addEventListener("disconnected",(()=>{e.controller.remove(...e.controller.children)})),e.controller.addEventListener("connected",(t=>{const n=t.data.handedness;e.controller.name=`${n}Controller`,"left"===n&&x(t,e,p)}));const M=yield w(e);return document.body.insertBefore(M,m),(()=>{const e=document.getElementById("loadingDiv");e&&(e.style.opacity="0",e.addEventListener("transitionend",(()=>{e&&e.remove()})))})(),{scene:d,camera:u,update:()=>{(()=>{const e="leftController"===k[0].controller.name?k[0]:k[1];if(e.controller&&e.controller.userData.selectPressed){n.identity().extractRotation(e.controller.matrixWorld),l.ray.origin.setFromMatrixPosition(e.controller.matrixWorld),l.ray.direction.set(0,0,-1).applyMatrix4(n);const t=l.intersectObjects([L]);t.length>0?(t[0].object.add(S),S.visible=!0):S.visible=!1}})()}}},new((l=void 0)||(l=Promise))((function(e,o){function r(e){try{s(d.next(e))}catch(e){o(e)}}function i(e){try{s(d.throw(e))}catch(e){o(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof l?n:new l((function(e){e(n)}))).then(r,i)}s((d=d.apply(t,n||[])).next())}));var t,n,l,d}}}const E=new b}}]);
//# sourceMappingURL=971.threejsBundle.js.map